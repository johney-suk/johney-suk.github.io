---
title: "Persist Option 데이터 영구 저장하기 AOF, RDB"
description: "Persist Option 데이터 영구 저장 방식 정리"
date: 2024-05-22
update: 2024-05-22
tags:
  - DataBase
  - Redis
series: "Redis 개념과 동작 원리"
---



## 인 메모리(In-Memory) 저장 방식
레디스는 데이터를 저장하는 공간이 특별합니다. 일반적으로 mysql, oracle 등의 RDB들이 하드디스크에 데이터를 저장하고 관리하는 것과는 달리 레디스는 데이터를 주기억장치인 ram, 즉 In-memory에서 관리된다. 해당 저장 방식의 문제점과 시스템의 안정성을 위해 보완을 해야할 방법에대해서 정리하고 공부한 내용 -> 

## 인 메모리(In-Memory) 저장 방식의 문제점
redis의 in memory 저장 방식은 빠르기도 하지만 DB 서버에 장애가 발생할 경우 또는 서버 전원이 갑자기 꺼지면 안에 있는 데이터들이 삭제된다. 그래서 보통은 로그인 세션 같은, 서버가 꺼져서 날아가도 상관 없는 임시 데이터에 주로 쓰인다. 그리고 대부분 속도의 장점으로 사용되기 때문에 압축은 하지 않으며, 데이터에 비해 RAM 용량이 넉넉하지 않을 경우 가상 메모리를 쓰게 되어 역효과가 일어나기도 한다.

## 저장 방식 문제점 보완을 위한 Persist Option 
![문제점 보완을 위한 Persist Option](./3.PNG)
 메모리 기반이지만 Redis는 영속적인 데이터 보존(Persistence)이 가능하다. (메모리는 원래 휘발성) 기존 데이터를 영속화하여 복구, 유지시키기 위해서는 디스크에 데이터 백업해주는 과정이 필요하다. 

백업 방식에는 1) RDB snapshot, 2) AOF 2가지가 있다.
> 여기서 `RDB`는 Redis DataBase를 의미한다.


#### RDB snapshot 방식

특정 시점을 스냅샷으로 남겨 데이터를 저장하는 방식을 말한다. redis.conf 파일에서 스냅샷 저장에 대한 주기 설정을 할 수 있다.

아래는 메신저 프로젝트 테스트 서버의 redis.conf에 `save 900 1 300 10 60 10000` 설정 값이다. 주석된 내용 처럼 조건이 여러 개 있을 때는 조건 중 하나라도 만족하면 save시킨다. 즉, 900초 동안 1개 이상의 데이터가 변경되거나 300초 동안 10개 이상의 데이터가 변경되거나 60초 동안 10000개 이상의 데이터가 변경되면 dump.rdb 파일을 생성하며 디스크에 데이터를 백업한다. 리부팅시에는 dump.rdb 파일이 있으면 읽어서 복구시킨다.
![redis.conf 설정](./2.PNG)

> RDB(snapthot)는 설정한 주기 및 데이터 양에따라 메모리에 있는 내용을 스냅샷을 떠서 DISK에 옮겨 담는 방식이다.

#### AOF 방식


## 선택 기준
백업은 필요하지만 어느정도 손실이 괜찮은 경우 ➡️ RDB 사용<Br>
장애 상황 직전까지의 데이터 보장이 필요한 경우 ➡️ AOF 사용

## 다음

[Redis의 저장 방식](../oauth-2.0/index.md) Redis의 저장 방식